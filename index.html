<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Global Wind and Satellite Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
    .leaflet-control-layers {
      background: white;
      padding: 6px;
    }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-velocity/dist/leaflet-velocity.min.js"></script>

<script>
  // Initialize Leaflet map
  const map = L.map('map', {
    center: [0, 0],
    zoom: 2,
    minZoom: 2,
    maxZoom: 9,
    worldCopyJump: true
  });

  // NASA GIBS Tile Layer (MODIS Terra True Color)
  const gibsLayer = L.tileLayer(
    'https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/2023-12-01/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg',
    {
      attribution: 'NASA GIBS',
      tileSize: 256,
      noWrap: true,
      continuousWorld: false,
      bounds: [[-85.0511, -180], [85.0511, 180]],
      maxZoom: 9
    }
  ).addTo(map);

  // Sample static wind data (can be replaced with actual grib2json converted data)
  const windData = {
    "data": [
      {
        "header": {
          "parameterCategory": 2,
          "parameterNumber": 2,
          "nx": 144,
          "ny": 73,
          "lo1": 0,
          "la1": 90,
          "lo2": 357.5,
          "la2": -90,
          "dx": 2.5,
          "dy": 2.5,
          "refTime": "2023-12-01T00:00:00Z",
          "parameterUnit": "m.s-1",
          "parameterNumberName": "u-component_of_wind",
          "surface": "surface",
          "level": 10
        },
        "data": new Array(144 * 73).fill(5) // Constant u-component (eastward)
      },
      {
        "header": {
          "parameterCategory": 2,
          "parameterNumber": 3,
          "nx": 144,
          "ny": 73,
          "lo1": 0,
          "la1": 90,
          "lo2": 357.5,
          "la2": -90,
          "dx": 2.5,
          "dy": 2.5,
          "refTime": "2023-12-01T00:00:00Z",
          "parameterUnit": "m.s-1",
          "parameterNumberName": "v-component_of_wind",
          "surface": "surface",
          "level": 10
        },
        "data": new Array(144 * 73).fill(2) // Constant v-component (northward)
      }
    ]
  };

  // Wind overlay using leaflet-velocity
  const velocityLayer = L.velocityLayer({
    displayValues: false,
    displayOptions: {
      velocityType: 'Global Wind',
      position: 'bottomleft',
      emptyString: 'No wind data'
    },
    data: windData,
    maxVelocity: 20,
    velocityScale: 0.005,
    particleAge: 90,
    lineWidth: 1,
    particleMultiplier: 0.4,
    frameRate: 20
  });

  velocityLayer.addTo(map);

  // Layer control
  const baseLayers = { "Satellite (MODIS)": gibsLayer };
  const overlayLayers = { "Wind Overlay": velocityLayer };
  L.control.layers(baseLayers, overlayLayers).addTo(map);
</script>
</body>
</html>

